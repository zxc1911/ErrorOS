## 0.1 Rust工具链安装

ErrorOS基于Rust语言开发。工欲善其事，必先利其器。

#### 安装Rust nightly

第一步是安装Rust。Rust编程语言有三个**发布通道**，即稳定版(stable)、测试版(beta)、开发版(nightly)。OS开发依赖大量不稳定特性，我们需要一些只有开发版nigtly才会提供的功能。

rustup是Rust官方推出的工具链管理器，我们会通过rustup下载Rust。

> **特别注意的是**，由于操作系统开发的核心工具链均对Linux/macOS有**一等支持**，而Windows需要额外解决兼容性问题；以及诸多底层关键工具仅对Unix-like有原生支持，windows版功能不全且不稳定。因此本实验内容仅支持**Linux/macOS**，如果你是windows用户的话可以使用WSL2、VMware Workstation等软件以虚拟机的方式安装linux操作系统。

打开你的linux或者macOS的终端，输入以下命令：

```
curl https://sh.rustup.rs -sSf | sh
```

这个命令会下载一个脚本来安装rustup工具。

```
Rust is installed now.Great!
```

安装成功了会出现如上内容。如果通过官方的脚本下载失败了，也可以在浏览器中输入网址https://sh.rustup.rs下载脚本在本地运行。

接下来，检查一下是否正确安装了Rust工具链，在命令行中输入：

```
rustc --version
```

应该会显示当前安装的工具链的版本

```
rustc 1.93.0-nightly (3d461af2a 2025-11-18)
```

注意哦，版本号末尾应该包含**"-nightly"**，否则说明你安装的不是nightly版本。可通过如下命令安装 rustc 的 nightly 版本：

```
rustup install nightly
rustup default nightly
```

---

#### 添加 RISC-V 目标支持

编译器在编译程序的时候，需要知道程序要在哪个目标平台运行，这个目标平台可以使用一个**目标三元组**来描述，它包含了的CPU架构、平台供应者、操作系统类型

比如说，笔者在某个程序处打开终端，输入以下命令行：

```
rustc --version --verbose
```

得到以下结果：

```
rustc 1.93.0-nightly (3d461af2a 2025-11-18)
binary: rustc
commit-hash: 3d461af2a23456a2676aadb13b4253c87bdfe28d
commit-date: 2025-11-18
host: aarch64-apple-darwin
release: 1.93.0-nightly
LLVM version: 21.1.5
```

其中**host**一项的内容`aarch64-apple-darwin`说明目标平台CPU架构师aarch64，CPU供应商是apple，操作系统类型是Darwin。

而我们编写的操作系统，需要在一台RISC-V架构裸机上运行内核。在项目根目录下面输入以下命令来完成目标架构配置：

```
rustup target add riscv64imac-unknown-none-elf
```

---

#### 配置 rust-src 组件

在终端中输入以下命令：

```
rustup component add rust-src --toolchain nightly
```

这条命令用于为nightly工具链安装**rust-src**组件，在裸机开发中，`rust-src`是必须组件，提供`core`库的源码，编译器会根据目标平台从源码构筑出适配的`core`库。
